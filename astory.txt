# Actualización de Base de Datos Supabase (Relacional)

Para mejorar la integridad de los datos y utilizar el poder de SQL, hemos migrado el detalle de las preguntas a una tabla independiente.

## 1. Tabla Principal: `exam_results`
Asegúrate de que la tabla `exam_results` tenga una columna `id` como clave primaria (esto es estándar en Supabase).

## 2. Nueva Tabla: `exam_answers`
Ejecuta el siguiente comando SQL en el editor de Supabase para crear la tabla que almacenará cada respuesta individual:

```sql
CREATE TABLE exam_answers (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    exam_id BIGINT REFERENCES exam_results(id) ON DELETE CASCADE,
    question_number INT NOT NULL,
    status TEXT NOT NULL, -- 'correct', 'incorrect', 'empty'
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Habilitar RLS (Opcional, según tu configuración)
ALTER TABLE exam_answers ENABLE ROW LEVEL SECURITY;
CREATE POLICY "Permitir inserciones públicas" ON exam_answers FOR INSERT WITH CHECK (true);
CREATE POLICY "Permitir lectura pública" ON exam_answers FOR SELECT USING (true);
```

## Beneficios
- **Normalización:** Los resultados individuales ahora están en su propia tabla, permitiendo consultas SQL directas (ej. "¿Cuál es la pregunta más difícil?").
- **Simplicidad:** No dependemos de parsear JSON para reportes básicos.
- **Escalabilidad:** Se pueden agregar más detalles por pregunta fácilmente en el futuro.
